<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <title>Will Edward&#39;s Programming: index</title>
    <link rel="stylesheet" type="text/css" href="static/style.css"/>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-27302158-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-27302158-1');
    </script>

</head>
<body>
<div class="content">
<div class="column">
    <div style="width: 90%;" class="page-link" onclick="window.location='index.html'">
    <h1>Will Edwards<br/><i>programming</i></h1>
    </div>
    <p><b>I have always loved programming</b> - its like Lego without gravity.</p>
    <p>Basic on my ZX81 graduating to assembler and Turbo Pascal during my teens.</p>
    <p>Developed phone OS software - engineer, architect, product manager - but got made irrelevant by the
        iPhone and redundant by Android.</p>
    <p style="font-size: 16pt; width:90%;">These days I mostly work with <b>data</b>, <b>big data</b> and <b><i>fitting big data onto small boxes</i></b>.</p>
</div>
<div class="posts-column column">
    <div class="page-title">
    <h1>index</h1>
    
    
        <hr/>
        <div class="index-bar">
        <button class="page-prev-link page-link" onclick="window.location='index5.html'">&larr;&nbsp;prev</button>
        <div class="pages-index">page 7 of 7</div>
        
        </div>
    

    </div>

<div class="post">
<div class="maximize-post" onclick="window.location='post/13270747573.html'"><img src="static/icons/maximize-2.svg"/></div>
<a name="13270747573">
    
</a>
<?xml version="1.0" ?><post-body><p>When playing with game engine ideas, I struggled with the fact that my laptops all
                had very very bad integrated chips by Intel.  Yeap, those ones.</p>
                <p>I wanted a nice cartoony fluffy clouds and bobbly trees, but all those spheres were taking just
                too many polygons.</p>
                <p>The solution I prototyped was to bill-board spheres… complete with depth.</p>
                <p>The billboard image was actually a depth-map.  I was using a special value to indicate no texel
                and do a discard in the fragment shader.</p>
                <p>To get nice edges on the spheres I did it in two passes; first pass, draw all opaque texels
                inside the circle of the billboard, setting depth; second pass, draw all semi-transparent texels on the
                edges of the spheres without setting depth (i.e. its at billboard depth).</p>
                <p>I found that I could draw almost a thousand such spheres at a good enough framerate on the
                worst cards.  On more average ATI and NVidia cards the framerate was nicely in the hundreds.  So this is
                a very efficient technique.</p>
                <p>Shadows can be done by sampling the depth buffer in a second pass and using a 1D texture that
                is the cross-section of the sphere.  I didn’t prototype that bit; its an exercise for the
                dedicated reader ;)</p>
            <iframe frameborder="0" src="https://www.youtube.com/embed/88idbFlvQV0"> </iframe></post-body>
 <button class="page-link" onclick="window.location='rec3.html#13270747573'">rec</button>  <button class="page-link" onclick="window.location='game1.html#13270747573'">game</button> 

    <span class="post-metadata"><i>posted 2011-11-24</i></span>
</div>

<div class="post">
<div class="maximize-post" onclick="window.location='post/13265116869.html'"><img src="static/icons/maximize-2.svg"/></div>
<a name="13265116869">
    <h2 onclick="window.location='post/13265116869.html'">Files and Programmatic Streams</h2>
</a>
<?xml version="1.0" ?><post-body><div><span>I originally published this on an OS hobby site in 2004; as I started
                actually working as an engineer on an operating system at that time, I stopped publishing ideas as a
                hobby ;)</span><br/><br/>This article offers feature suggestions to budding OS
                developers looking for that neat edge.
                <p>Conventionally, each file on a computer system has a type. Different operating systems
                typically had different ways of working out the logical type of a file. UNIX uses a special flag to see
                if a file was ‘executable’, otherwise it is 'data’. Therefore,
                applications on UNIX have a variety of strategies for determining the file type. Some programs use the
                file extension as a hint (.jpeg is probably an image, for example) whereas others use more advanced
                heuristics (e.g. the UNIX 'file’ command) sometimes called 'magic’. MS-DOS and
                MS-Windows use the file extension to determine the type (.exe for executables, .txt for text files etc).
                More recent operating systems have embraced more recent classification systems such as MIME. In BeOS,
                for example, a server scans files and marks the MIME type of them in an attribute (basically caching the
                guess from the UNIX-style 'file’ heuristics) so that it can easily be looked at later. Almost
                all Internet content is marked with a MIME type (web pages, files received via email etc) and this can
                clearly indicate to the receiving computer the intended type of a file.</p>
                <p>Now let me introduce something slightly novel and new! Imagine that our new hobby operating
                system supports multi-stream files. Each stream in a file is a certain MIME type. Some of these streams
                might be generated programmatically on-the-fly, and basically encapsulate conversion. These programmatic
                streams allow plug-in filters and converters to be integrated into the operating system and used by
                programs. Let us explore what this might mean and how it might be used by programs:</p>
                <p>The operating system knows the actual MIME type of a file. It also has a list of programmatic
                stream plug-ins associated with each MIME type to handle the interpretation of a stream of one type into
                that of another. An obvious plug-in would be to filter text/html so that it was text/plain, stripping
                out the markup. Another plug-in might convert image/jpeg to image/gif. Another might extract the
                soundtrack of a movie file and present it as audio/wav.</p>
                <p>An application/x-idx file might have a programmatic stream of type text/gnu-makefile, while
                another programmatic stream might convert text/gnu-makefile streams into application/bash shell scripts.
                Therefore the operating system can string together these streams transparently, making an
                application/x-idx file executable in at a bash prompt.</p>
                <p>Encodings and character sets might also be incorporated into the same system, for on-the-fly
                conversion between various sets. A code snippet:</p>
                <p>FILE *f = fopen_ex(“ftp://stop.blogging.com/varfar/myos.zip/documents/filesystem.pdf”,“rb”,“text/html;charset=
                iso-8859-1”);</p>
                <p>A file selector dialog might have the file type set as a MIME type and display all documents
                that match a specific MIME type that the application understands without the application having to
                understand the conversion process.</p>
                <p>Most conversions are lossy ’ they remove information and meta-data, downgrading the
                quality of a source. Therefore, it is anticipated that almost all programmatic streams might be
                read-only. Many programmatic plug-ins’ might be easiest to implement if they support
                sequential access only. For this reason, it makes sense for the file selector dialog to be able to
                filter out streams with inappropriate access (e.g. only display application/ogg streams that are
                writeable and support random access). However, the opportunity is there for super plug-ins that
                facilitates content stored as one type to be completely edited as another, e.g. reading and writing to
                an application/ms-word file with an application that only understands application/x-multipart-html.</p>
                <p>Let me extend the idea even further. Not only might a file be multi-streamed, it might also be
                multi-part! Many file formats encapsulate multiple content parts ’ a movie has both image
                frames and a soundtrack; a rich document has text, drawing and images embedded; a mail message might
                contain a plain-text version, a rich text version or two and many attachments. An archive contains
                multiple files inside.</p>
                <p>Such files could be presented to programs as directories. You could now use your favorite
                drawing program to edit the individual frames of a movie!</p>
                <p>Directories themselves can have streams too. In the case of a virtual directory being generated
                from a single file, the directory’s stream would be the actual physical file (and programmatic
                streams that convert it). A conventional directory might have a text/html stream the serves the
                index.html file that it contains; another directory stream might provide a tar file of it and its
                children.</p>
                <p>Conversion libraries on most operating systems abound. Typically these libraries are
                fragmented, often unwieldy, often exposing technical details, and not pervasively used.</p>
                <p>A new hobby operating system has the opportunity to provide a uniform interface between
                applications and these conversion filters, in a way that is minimum effort for application programmers
                and in a way that is extendable (by providing more conversion filter plug-ins) without requiring extra
                code nor recompiling or re-linking of all applications. Placing this conversion into the way that files
                are provided to applications is, in my opinion, an excellent way to achieve this.</p>
                <p>Programmatic streams do not expose many parameters to tweak conversion and therefore do not
                completely replace the need for dedicated, detailed conversion libraries for dedicated programs. But
                they do further the usability of the average program in the normal operating scenario.</p>
                </div>
            </post-body>
 <button class="page-link" onclick="window.location='classic1.html#13265116869'">classic</button> 

    <span class="post-metadata"><i>posted 2011-11-24</i></span>
</div>

<div class="post">
<div class="maximize-post" onclick="window.location='post/13265364121.html'"><img src="static/icons/maximize-2.svg"/></div>
<a name="13265364121">
    <h2 onclick="window.location='post/13265364121.html'">popen3</h2>
</a>
<?xml version="1.0" ?><post-body><p>I was a bit confused; there didn’t seem to be a <code>popen3</code>
                function for c/c++ anywhere.  Sure, there are some <code>popen2</code> out there, but to my
                eye all those I found were buggy. And what about <code>STDERR</code>?<br/><br/>
                Remember, if you’re using this, to make heavy use of <code>O_CLOEXEC</code> (that’s
                backwards! I think its broken that you have to say which you want closed, rather than having to
                specifically say which you want to remain open). Or you could add some horrid forced closing of all
                possible file handles (there is a fast, portable way to do that?).<br/><br/> I tend to
                immediately set the returned descriptors to <code>O_NONBLOCKING</code> and that works great.<br/><br/>
                Here’s a bowdlerised version of my <code>popen3()</code>:<br/><br/></p>
                <pre> 3 <strong>int</strong> popen3<strong>(</strong><strong>int</strong>
                fd<strong>[</strong>3<strong>]</strong><strong>,</strong><strong>const</strong>
                <strong>char</strong> <strong>*</strong><strong>*</strong><strong>const</strong>
                cmd<strong>)</strong> <strong>{</strong>
                4 <strong>int</strong> i<strong>,</strong> e<strong>;</strong>
                5 <strong>int</strong> p<strong>[</strong>3<strong>]</strong><strong>[</strong>2<strong>]</strong><strong>;</strong>
                6 pid_t pid<strong>;</strong>
                7 // set all the FDs to invalid
                8 <strong>for</strong><strong>(</strong>i<strong>=</strong>0<strong>;</strong>
                i<strong>&lt;</strong>3<strong>;</strong> i<strong>+</strong><strong>+</strong><strong>)</strong>
                9 p<strong>[</strong>i<strong>]</strong><strong>[</strong>0<strong>]</strong>
                <strong>=</strong> p<strong>[</strong>i<strong>]</strong><strong>[</strong>1<strong>]</strong>
                <strong>=</strong> <strong>-</strong>1<strong>;</strong>
                10 // create the pipes
                11 <strong>for</strong><strong>(</strong><strong>int</strong> i<strong>=</strong>0<strong>;</strong>
                i<strong>&lt;</strong>3<strong>;</strong> i<strong>+</strong><strong>+</strong><strong>)</strong>
                12 <strong>if</strong><strong>(</strong>pipe<strong>(</strong>p<strong>[</strong>i<strong>]</strong><strong>)</strong><strong>)</strong>
                13 <strong>goto</strong> error<strong>;</strong>
                14 // and fork
                15 pid <strong>=</strong> fork<strong>(</strong><strong>)</strong><strong>;</strong>
                16 <strong>if</strong><strong>(</strong><strong>-</strong>1 <strong>=</strong><strong>=</strong>
                pid<strong>)</strong>
                17 <strong>goto</strong> error<strong>;</strong>
                18 // in the parent?
                19 <strong>if</strong><strong>(</strong>pid<strong>)</strong> <strong>{</strong>
                20 // parent
                21 fd<strong>[</strong>STDIN_FILENO<strong>]</strong> <strong>=</strong>
                p<strong>[</strong>STDIN_FILENO<strong>]</strong><strong>[</strong>1<strong>]</strong><strong>;</strong>
                22 close<strong>(</strong>p<strong>[</strong>STDIN_FILENO<strong>]</strong><strong>[</strong>0<strong>]</strong><strong>)</strong><strong>;</strong>
                23 fd<strong>[</strong>STDOUT_FILENO<strong>]</strong> <strong>=</strong>
                p<strong>[</strong>STDOUT_FILENO<strong>]</strong><strong>[</strong>0<strong>]</strong><strong>;</strong>
                24 close<strong>(</strong>p<strong>[</strong>STDOUT_FILENO<strong>]</strong><strong>[</strong>1<strong>]</strong><strong>)</strong><strong>;</strong>
                25 fd<strong>[</strong>STDERR_FILENO<strong>]</strong> <strong>=</strong>
                p<strong>[</strong>STDERR_FILENO<strong>]</strong><strong>[</strong>0<strong>]</strong><strong>;</strong>
                26 close<strong>(</strong>p<strong>[</strong>STDERR_FILENO<strong>]</strong><strong>[</strong>1<strong>]</strong><strong>)</strong><strong>;</strong>
                27 // success
                28 <strong>return</strong> 0<strong>;</strong>
                29 <strong>}</strong> <strong>else</strong> <strong>{</strong>
                30 // child
                31 dup2<strong>(</strong>p<strong>[</strong>STDIN_FILENO<strong>]</strong><strong>[</strong>0<strong>]</strong><strong>,</strong>STDIN_FILENO<strong>)</strong><strong>;</strong>
                32 close<strong>(</strong>p<strong>[</strong>STDIN_FILENO<strong>]</strong><strong>[</strong>1<strong>]</strong><strong>)</strong><strong>;</strong>
                33 dup2<strong>(</strong>p<strong>[</strong>STDOUT_FILENO<strong>]</strong><strong>[</strong>1<strong>]</strong><strong>,</strong>STDOUT_FILENO<strong>)</strong><strong>;</strong>
                34 close<strong>(</strong>p<strong>[</strong>STDOUT_FILENO<strong>]</strong><strong>[</strong>0<strong>]</strong><strong>)</strong><strong>;</strong>
                35 dup2<strong>(</strong>p<strong>[</strong>STDERR_FILENO<strong>]</strong><strong>[</strong>1<strong>]</strong><strong>,</strong>STDERR_FILENO<strong>)</strong><strong>;</strong>
                36 close<strong>(</strong>p<strong>[</strong>STDERR_FILENO<strong>]</strong><strong>[</strong>0<strong>]</strong><strong>)</strong><strong>;</strong>
                37 // here we try and run it
                38 execv<strong>(</strong><strong>*</strong>cmd<strong>,</strong>const_cast<strong>&lt;</strong><strong>char</strong><strong>*</strong><strong>const</strong><strong>*</strong><strong>&gt;</strong><strong>(</strong>cmd<strong>)</strong><strong>)</strong><strong>;</strong>
                39 // if we are there, then we failed to launch our program
                40 perror<strong>(</strong>&quot;Could not launch&quot;<strong>)</strong><strong>;</strong>
                41 fprintf<strong>(</strong>stderr<strong>,</strong>&quot; \&quot;%s\&quot;\n&quot;<strong>,</strong><strong>*</strong>cmd<strong>)</strong><strong>;</strong>
                42 _exit<strong>(</strong>EXIT_FAILURE<strong>)</strong><strong>;</strong>
                43 <strong>}</strong>
                44 error<strong>:</strong>
                45 // preserve original error
                46 e <strong>=</strong> errno<strong>;</strong>
                47 <strong>for</strong><strong>(</strong>i<strong>=</strong>0<strong>;</strong>
                i<strong>&lt;</strong>3<strong>;</strong> i<strong>+</strong><strong>+</strong><strong>)</strong>
                <strong>{</strong>
                48 close<strong>(</strong>p<strong>[</strong>i<strong>]</strong><strong>[</strong>0<strong>]</strong><strong>)</strong><strong>;</strong>
                49 close<strong>(</strong>p<strong>[</strong>i<strong>]</strong><strong>[</strong>1<strong>]</strong><strong>)</strong><strong>;</strong>
                50 <strong>}</strong>
                51 errno <strong>=</strong> e<strong>;</strong>
                52 <strong>return</strong> <strong>-</strong>1<strong>;</strong>
                53 <strong>}</strong></pre>
            </post-body>
 <button class="page-link" onclick="window.location='lang.html#13265364121'">lang</button> 

    <span class="post-metadata"><i>posted 2011-11-24</i></span>
</div>

<div class="post">
<div class="maximize-post" onclick="window.location='post/13266702492.html'"><img src="static/icons/maximize-2.svg"/></div>
<a name="13266702492">
    
</a>
<?xml version="1.0" ?><post-body><p>The first step in the robot build was to go to a scrapyard and get some
                window-screen wiper motors.</p>
                <p>They seemed perfect; 12V DC is easy to drive with a car or motorcycle battery.  They are very
                strong, slow, designed for continuous running.  What’s not to like?</p>
                <p>Our pair were from a Saab 900 and an old Volvo, but seemed to be pretty much the same make and
                model.</p>
            <iframe frameborder="0" src="https://www.youtube.com/embed/DnCfEZ8L5pc"> </iframe></post-body>
 <button class="page-link" onclick="window.location='rec3.html#13266702492'">rec</button>  <button class="page-link" onclick="window.location='robot.html#13266702492'">robot</button> 

    <span class="post-metadata"><i>posted 2011-11-24</i></span>
</div>

<div class="post">
<div class="maximize-post" onclick="window.location='post/13266300297.html'"><img src="static/icons/maximize-2.svg"/></div>
<a name="13266300297">
    
</a>
<?xml version="1.0" ?><post-body><p>Haxe is a great tool for making Flash programs in.  One thing that Haxe supports is
                special op-codes for raw memory access.</p>
                <ul><li>allocate the buffer using <a alt="dead link: http://haxe.org/com/libs/basicmemorymanager" href="/#404" rel="nofollow" target="_blank">will.basicMemoryManager</a></li>
                <li>we let the object container do the rotation and such</li>
                <li>for each frame, we regenerate the image that we’re spinning</li>
                <li>the voxels look like columns, but are actually streaks on a flat image</li>
                <li>in this example we take an aerial view of London and use edge-detection to give us some
                heights; you could obviously create a better height-map</li>
                <li>we only have to calculate the offsets for the pixels in the line using Bresenham for each
                rotation once, and can put this into the memory</li>
                <li>we can then walk this list of offsets for each voxel stack</li>
                <li>it’s important we start walking from the right edge in the right direction to
                z-order problems</li>
                <li>we can pre-calculate if voxels are never visible and skip them</li>
                </ul>
            <iframe frameborder="0" src="https://www.youtube.com/embed/7-pm1-bBj0M"> </iframe></post-body>
 <button class="page-link" onclick="window.location='rec3.html#13266300297'">rec</button>  <button class="page-link" onclick="window.location='game1.html#13266300297'">game</button> 

    <span class="post-metadata"><i>posted 2011-11-24</i></span>
</div>

<div class="post">
<div class="maximize-post" onclick="window.location='post/13266867070.html'"><img src="static/icons/maximize-2.svg"/></div>
<a name="13266867070">
    
</a>
<?xml version="1.0" ?><post-body><p>Our very first drive!</p>
                <p>One motors don’t quite go the same speed forwards as backwards; searching the
                Internet, this is confirmed by others and there are even instructions in how to rewind them.</p>
                <p>For our purposes, as we’ll hook up a proper little ARM CPU to drive the ‘bot,
                it suits us to have unequal motors.  We’ll know its working when it drives in a straight line…</p>
            <iframe frameborder="0" src="https://www.youtube.com/embed/EkZVTE32c3Q"> </iframe></post-body>
 <button class="page-link" onclick="window.location='rec3.html#13266867070'">rec</button>  <button class="page-link" onclick="window.location='robot.html#13266867070'">robot</button> 

    <span class="post-metadata"><i>posted 2011-11-24</i></span>
</div>

<div class="post">
<div class="maximize-post" onclick="window.location='post/13265015351.html'"><img src="static/icons/maximize-2.svg"/></div>
<a name="13265015351">
    <h2 onclick="window.location='post/13265015351.html'">Direct Pixel Access in Cython</h2>
</a>
<?xml version="1.0" ?><post-body><div>
                <p>I wanted to ‘plot’ a few thousand points over an image, so I did the most
                obvious thing:</p>
                <pre><code>
                class MyWidget(gtk.Widget):
                ...
                do_expose_event(self,event):
                # get the context
                gc = self.window.cairo_create()
                gc.rectangle(event.area.x,event.area.y,event.area.width,event.area.height)
                gc.clip()
                # draw the image
                gc.set_source_surface(self.image)
                gc.paint()
                # draw the points on top
                for point in self.points:
                gc.move_to(point.x-2,point.y)
                gc.rel_line_to(+4,0)
                gc.rel_move_to(-2,-2)
                gc.rel_line_to(0,+4)
                gc.stroke()
                </code></pre>
                <p>Well, that’s the usual bowdlerised translation of what I was doing, so cut-n-pasters
                beware!</p>
                <p>Anyway, it was dog slow.</p>
                <p>So I got out the profiler:</p>
                <p><code> python -m cProfile -o prof my_script.py<br/> runsnake prof </code></p>
                <p>And the time taken was all that stroking! A friendly cairo hacker suggested that I draw the
                cross once onto a bitmap and then use that as a brush or something. I didn’t follow through on
                that. Instead, I moved it all across into cython. I couldn’t work out how to get from an <code>ImageSurface.get_data()</code>
                to a <code>char*</code>, but I could work out how to get an ImageSurface to wrap (“proxy”)
                a buffer the cython code allocated. So I made a nice little class that plots to an array of pixel data,
                and has an ImageSurface proxy. And because it’s cython, its fantastically zipply. Ok, not as
                blazingly zippy as, say, C++. But now the cost of the plotting has evaporated from the profiling
                hitlist.</p>
                <pre><code>
                import array
                import cairo

                cdef class FastOverlay:
                cdef int w, h
                cdef int stride
                cdef size_t size
                cdef pixels # an array of the actual pixel data for us to manipulate directly
                cdef readonly image # the cairo ImageSurface object that proxies those pixels
                def __init__(self,w,h):
                self.w, self.h = w, h
                # allocate a buffer for the pixels
                self.stride = cairo.ImageSurface.format_stride_for_width(cairo.FORMAT_ARGB32,w)
                self.size = h * self.stride
                self.pixels = array.array(&quot;B&quot;,&quot;\0&quot;*self.size)
                # create an ImageSurface to proxy it
                self.image = cairo.ImageSurface.create_for_data(self.pixels,cairo.FORMAT_ARGB32,w,h)
                # this is an example of a function that does direct pixel access
                def void plot_points(self,points):
                # each function we want to do direct-pixel access, we get a naked pointer
                cdef char* pixels = (self.pixels.buffer_info()[0])
                cdef char* sentinal = pixels + self.size
                cdef int stride = self.stride, ofs
                for point in points:
                # this is a 'set_pixel' bit of code; you could refactor this into
                # a nice cdef inline etc
                # I'm just plotting a pixel, not drawing a cross, but you can
                # extrapolate how to do more advanced drawing
                ofs = int(point.y)*stride+int(point.x)*4
                # you probably want to double-check you're in bounds
                if (ofs &lt; pixels) or (ofs &gt;= sentinal):
                # whatever
                continue
                pixels[ofs+1] = 255 # G
                pixels[ofs+3] = 255 # A
                return self.image
                </code></pre>
                <p>And to call it:</p>
                <pre><code>
                # draw the image
                gc.set_source_surface(self.image)
                gc.paint()
                # draw the points on top
                if self.point_overlay is None:
                overlay = FastOverlay(self.image.get_width(),self.image.get_height())
                self.point_overlay = overlay.plot_points(self.points)
                gc.set_source_surface(self.point_overlay)
                gc.paint()
                </code></pre>
                <p>Hopefully this gives the component parts needed by anyone wanting to move some custom drawing
                code into cython.</p>
                </div>
            </post-body>
 <button class="page-link" onclick="window.location='lang1.html#13265015351'">lang</button> 

    <span class="post-metadata"><i>posted 2011-11-24</i></span>
</div>

<div class="post">
<div class="maximize-post" onclick="window.location='post/13264962223.html'"><img src="static/icons/maximize-2.svg"/></div>
<a name="13264962223">
    <h2 onclick="window.location='post/13264962223.html'">Sum of Absolute Differences</h2>
</a>
<?xml version="1.0" ?><post-body><div>
                <p>My thanks to my super hacker friend Joonas for teaching me this; I’ve used this code
                as a template for SSE code ever since</p>
                <pre><code>#include &lt;emmintrin.h&gt;
                #include &lt;assert.h&gt;

                typedef unsigned char block4x4_t[4*4] __attribute__((__aligned__(16)));
                typedef unsigned char block8x8_t[8*8] __attribute__((__aligned__(16)));
                typedef unsigned char block16x16_t[16*16] __attribute__((__aligned__(16)));

                template&lt;typename block_t&gt; unsigned sad(const block_t&amp; a,const block_t&amp; b)
                {
                enum { N = sizeof(block_t)/16 };
                assert(sizeof(block_t)==sizeof(__m128i[N]));
                __m128i *a_sse = (__m128i*)&amp;a;
                __m128i *b_sse = (__m128i*)&amp;b;
                __m128i x = _mm_set1_epi8(0);
                for(int n=0; n&lt;N; n++)
                x += _mm_sad_epu8(a_sse[n],b_sse[n]);
                __m128i y = _mm_shuffle_epi32(x,_MM_SHUFFLE(1,1,1,2));
                return _mm_cvtsi128_si32(_mm_add_epi16(x,y));
                }</code></pre>
                </div>
            </post-body>
 <button class="page-link" onclick="window.location='lang1.html#13264962223'">lang</button> 

    <span class="post-metadata"><i>posted 2011-11-24</i></span>
</div>

<div class="post">
<div class="maximize-post" onclick="window.location='post/13266992357.html'"><img src="static/icons/maximize-2.svg"/></div>
<a name="13266992357">
    
</a>
<?xml version="1.0" ?><post-body><p>We finally might have found some paper we can use to transfer laser<br/> toner
                to PCBs!<br/><br/> We’ve been exhaustively testing various glossy magazine and
                brochures<br/> and things and its proved hard to find paper that feeds properly<br/> through
                our printer; we’ve had the printer apart in ways you won’t<br/> find in the
                handbook trying to find missing incriminating pages.<br/><br/> Taping these pages to proper
                A4 paper in the hope it’d feed better<br/> turned out to be a big mistake.  Massive
                mistake.  But the printer<br/> works again now so that’ll be our secret.<br/><br/>
                The only success we’ve had is to print out the mask onto some 15yo<br/> deskjet photo
                paper and quickly iron it onto the board.  Then we soak<br/> it for a few minutes in water and
                then rub the paper off with our<br/> thumbs.  We’ve been testing with normal kitchen
                foil, and hope that it<br/> works as well on proper board.<br/><br/> There are people
                on the internet who claim to have adapted laser<br/> printers to feed flat sheet PCB through
                directly, and then they chuck<br/> it in a warm oven for a few minutes to ensure its properly
                fused.  We<br/> had started to think along those lines, although I rather imagine a<br/>
                lego mindstorms printer - or laser etcher - being a more fun build<br/><a href="https://www.youtube.com/watch?v=zX09WnGU6ZY" target="_blank">http://www.youtube.com/watch?v=zX09WnGU6ZY</a>
                .  Of course a proper UV<br/> light box would be easier that that route.<br/><br/>
                Ironing seems strangely pleasingly amateurish.</p>
            <p><a href="media/old/13266992357_2.jpg"><img src="media/old/13266992357_3.jpg"/></a></p></post-body>
 <button class="page-link" onclick="window.location='rec3.html#13266992357'">rec</button>  <button class="page-link" onclick="window.location='robot.html#13266992357'">robot</button> 

    <span class="post-metadata"><i>posted 2011-11-24</i></span>
</div>

<div class="post">
<div class="maximize-post" onclick="window.location='post/13265549295.html'"><img src="static/icons/maximize-2.svg"/></div>
<a name="13265549295">
    
</a>
<?xml version="1.0" ?><post-body><div>
                <div>A while back I was interested in how you might lay out a road.  I’d been looking at
                classic tile-based games like simcity and I wanted to get away from tiles.</div>
                <br/>
                <div>If you lay out a path and the road takes a sweeping hermite spline then it feels just plain
                wrong.</div>
                <br/>
                <div>I got much better results from treating each joint as a circle and joining up the tangents of
                adjacent joints.</div>
                <br/><div>I thought you can get very nice tiling of the road/train-track/whatever if you use
                a texture atlas where the tiles are arranged vertically, letting you use GL_REPEAT on the horizontal.
                 You then generate a quad strip without needing to divide long straights into too many quads whilst
                still having the option of a bit of variety and such.</div>
                </div>
            <iframe frameborder="0" src="https://www.youtube.com/embed/PAVksn4btKU"> </iframe></post-body>
 <button class="page-link" onclick="window.location='rec3.html#13265549295'">rec</button>  <button class="page-link" onclick="window.location='game1.html#13265549295'">game</button> 

    <span class="post-metadata"><i>posted 2011-11-24</i></span>
</div>

<div class="post">
<div class="maximize-post" onclick="window.location='post/13267053658.html'"><img src="static/icons/maximize-2.svg"/></div>
<a name="13267053658">
    
</a>
<?xml version="1.0" ?><post-body><p>Another Wednesday, another trip to the ‘office’ to meet my<br/>
                co-conspirators and go robot supplies shopping.<br/><br/> It didn’t quite go as
                planned with the ironing-on masking approach;<br/> sadly our nearby shop that sells board and such
                - Kjell&amp;Co - has<br/> stopped stocking the plain copper ones and now only the UV-sensitive<br/>
                ones are available.  And it seemed a shame to have to clean off the UV<br/> layer and iron-on our
                mask, so we opted to splash out on a UV lamp<br/> instead.  We also got the acid, developer and
                other bits and pieces<br/> like lunch-boxes to put the acid in and so on.<br/><br/> We
                printed the mask out onto overhead film.  Two copies, to make sure<br/> its definitely dark
                enough.<br/><br/> The plan is to make the some simple test exposures to get the timing<br/>
                right and such, and then develop the H-bridge board.  Once that’s been<br/> soldered and
                is controlling some simple lamps it’ll be time to think<br/> about joining our ARM chip
                board to it.<br/><br/> Its going to be a smelly weekend with the acid</p>
            <p><a href="media/old/13267053658_2.jpg"><img src="media/old/13267053658_3.jpg"/></a></p></post-body>
 <button class="page-link" onclick="window.location='rec3.html#13267053658'">rec</button>  <button class="page-link" onclick="window.location='robot.html#13267053658'">robot</button> 

    <span class="post-metadata"><i>posted 2011-11-24</i></span>
</div>


    
        
        <div class="index-bar">
        <button class="page-prev-link page-link" onclick="window.location='index5.html'">&larr;&nbsp;prev</button>
        <div class="pages-index">page 7 of 7</div>
        
        </div>
    

</div>


<div class="column">
    <div class="page-map">
        <h1 style="text-align: center">jump to &darr;</h1>
        <hr/>
        
        
            


        
            

    <div class="page-map-branch">
    <b>performance</b>
        
            <img class="feather" src="static/icons/bar-chart-2.svg"/>
        
        
            <div class="page-map-section">
            
                
                    <div class="page-map-leaf" onclick="window.location='post/172424230628.html'">Faster searches with non-prefix fields in composite indices</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/160628887798.html'">Compressing MySQL databases</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/53836725910.html'">What highscalability.com says about Scaling my Server</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/53751799442.html'">Scaling my Server: follow-up</div>
                
            
                
                    <div class="page-link" onclick="window.location='perf.html'">more&nbsp;&rarr;</div>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            </div>
        
    </div>


        
            

    <div class="page-map-branch">
    <b>old classics</b>
        
            <img class="feather" src="static/icons/book-open.svg"/>
        
        
            <div class="page-map-section">
            
                
                    <div class="page-map-leaf" onclick="window.location='post/49786413417.html'">The kid&#39;s computer</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/37291851878.html'">Making the History of Worlds Religions map</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/25564136097.html'">If you defend those involved in the OpenGL ES specification, you are an idiot</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/25426541504.html'">Stackoverflow unwinding?</div>
                
            
                
                    <div class="page-link" onclick="window.location='classic.html'">more&nbsp;&rarr;</div>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            </div>
        
    </div>


        
            

    <div class="page-map-branch">
    <b>general</b>
        
            <img class="feather" src="static/icons/terminal.svg"/>
        
        
            <div class="page-map-section">
            
                
                    <div class="page-map-leaf" onclick="window.location='post/134911547413.html'">Why Swift?</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/94734034483.html'">Python annotations and type checking</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/86488099258.html'">pycon 2014 Sweden: the bad bits</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/78636919764.html'">Table-based Template Translation in C++</div>
                
            
                
                    <div class="page-link" onclick="window.location='lang.html'">more&nbsp;&rarr;</div>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            </div>
        
    </div>


        
            

    <div class="page-map-branch">
    <b>recreation</b>
        
            <img class="feather" src="static/icons/youtube.svg"/>
        
        
            <div class="page-link" onclick="window.location='rec.html'">all&nbsp;&rarr;</div>
            <div class="page-map-section">
            
                

    <div class="page-map-branch">
    <b>games programming</b>
        
            <img class="feather" src="static/icons/play.svg"/>
        
        
            <div class="page-map-section">
            
                
                    <div class="page-map-leaf" onclick="window.location='post/57140204975.html'">Perlin Noise</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/57181055984.html'">Perlin Noise</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/53831974133.html'">Drawing RTS maps fast</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/49797579721.html'">WillCity update</div>
                
            
                
                    <div class="page-link" onclick="window.location='game.html'">more&nbsp;&rarr;</div>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            </div>
        
    </div>


            
                

    <div class="page-map-branch">
    <b>ludum-dare</b>
        
        
            <div class="page-map-section">
            
                
                    <div class="page-map-leaf" onclick="window.location='post/143376853353.html'">Ludum Dare #35 Mosaic</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/127137593983.html'">LudumDare 33 wallpapers</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/117234199303.html'">SSIM vs MSE for Mosaics</div>
                
            
                
                    <div class="page-map-leaf" onclick="window.location='post/97634254788.html'">Ludum Dare 30 results are in!</div>
                
            
                
                    <div class="page-link" onclick="window.location='ludum-dare.html'">more&nbsp;&rarr;</div>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
            </div>
        
    </div>


            
            </div>
        
    </div>


        
        
    </div>
</div>
</div>
</body>
</html>